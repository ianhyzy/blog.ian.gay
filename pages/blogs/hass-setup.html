<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"
  />
  <title>Home Assistant Setup | Blog | Ian Hyzy</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link href="/css/style.css" type="text/css" rel="stylesheet" media="screen,projection" />
</head>
<script>
  (function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-64244355-1', 'auto');
  ga('send', 'pageview');
</script>

<body>
  <nav class="blue" role="navigation">
    <div class="nav-wrapper container">
      <a href="#" class="brand-logo">Ian Hyzy</a>
      <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="/index.html"><i class="left material-icons">home</i>Home</a></li>
        <li><a href="/pages/aboutme.html"><i class="left material-icons">person</i>About Me</a></li>
        <li><a href="/pages/portfolio.html"><i class="left material-icons">view_carousel</i>Portfolio</a></li>
        <li class="active"><a href="blog.html"><i class="left material-icons">speaker_notes</i>Blog</a></li>
      </ul>
    </div>
  </nav>

  <ul class="sidenav" id="mobile-demo">
    <li><a href="/index.html"><i class="left material-icons">home</i>Home</a></li>
    <li><a href="/pages/aboutme.html"><i class="left material-icons">person</i>About Me</a></li>
    <li><a href="/pages.portfolio.html"><i class="left material-icons">view_carousel</i>Portfolio</a></li>
    <li class="active"><a href="blog.html"><i class="left material-icons">speaker_notes</i>Blog</a></li>
  </ul>

  <div class="container">
    <div class="section">
      <div class="row">
        <div class="col s12 m12 l12">
          <div class="valign-wrapper full-card">
            <div class="card wide">
              <div class="fullcard-text card-content">
                <h3 class="grey-text text-darken-3">My Smart Home Guide</h3>
                <hr>
                <div class="row">
                  <div class="col s12 m12 l8">
                    <h4>Intro</h4>
                    <p class="blog-body">
                      I've setup everything in my home to talk to everything else, which is no small feat. I have my media center, lights, music, switches, and more controlled with Home Assistant. Sonarr and Radarr download and organize movies & TV shows that Plex then streams to any device. I can press one button on my universal remote to dim the lights and turn on my TV and soundbar to the right input to start a movie. This is what it takes to make that happen.
                    </p>
                    <h4>Parts List</h4>
                    <p class="blog-body">Most guides for Home Assistant assume you're using a generic Linux box or a Raspberry Pi. While many things are the same between Synology's Linux and Debian-based distros like Ubuntu and Raspbian, there's some differences when using a Synology device.</p>
                    <ul>
                      <li>🖥Synology DS418play</li>
                      <li><a href="https://smile.amazon.com/gp/product/B01GJ826F8/ref=oh_aui_detailpage_o02_s00?ie=UTF8&psc=1" target="_blank">🔎USBZB-1 USB Hub</a></li>
                      <li><a href="https://smile.amazon.com/gp/product/B0197840KQ/ref=oh_aui_search_detailpage?ie=UTF8&psc=1" target="_blank">💡Sylvania RGBW Bulbs</a></li>
                      <li><a href="https://smile.amazon.com/gp/product/B0196M620Y/ref=oh_aui_search_detailpage?ie=UTF8&psc=1" target="_blank">🔄Sylvania Switch</a></li>
                      <li><a href="">📺Harmony Hub + Home Control remote</a></li>
                    </ul>
                    <h4>Step 1: Preparing your NAS and Docker</h4>
                    <p class="blog-body">While you will need to use the command line to setup Home Assistant in docker, I still use the docker package that's available to easily manage my six other docker installs, which do not need the command line options to start. The Docker package doesn't support the <code>device</code> argument, which is used to allow the docker container to read the Zigbee/Z-Wave USB stick. It's easy to do, just follow <a href="https://tylermade.net/2017/09/28/how-to-install-docker-on-an-unsupported-synology-nas/" target="_blank"> this guide</a> to install the .spk.
                    </p>
                    <p class="blog-body">You'll also need to enable SSH under <code>Control Panel > Terminal and SNMP</code></p>
                    <h4>Step 2: Installing Home Assistant</h4>
                    <p class="blog-body">Installing home assistant requires a few steps with Docker and your NAS.</p>
                    <h5>Step 2.1: Installing the USB drivers</h5>
                    <p class="blog-body">The Z-Wave/Zigbee USB stick requires some third-party drivers to function properly. Find the right version <a href="http://www.jadahl.com/drivers/">here.</a> You'll need to know the CPU generation of your Synology. The DS418play has an Apollo Lake processor. The device will require a reboot once the drivers installed.</p>
                    <p class="blog-body">todo: fill in link</p>
                    <h5>Step 2.2: Install the Home Assistant docker container</h5>
                    <p class="blog-body">Docker "containers" are tiny operating systems built to run a specific program or set of programs. They're nice to use because they're easy to update and configure.</p>
                    <p class="blog-body">When Docker is upgraded, all data in the container is lost. To make sure you don't lost any data, make a folder in a Synology library. You'll tell the Home Assistant container to store configuration files in this folder. This will also make them much easier to edit.</p>
                    <p class="blog-body">todo: fill in screenshots</p>
                    <h5>Step 2.3 (Optional): Install Home Assistant Configurator</h5>
                    <p class="blog-body">You can edit your files with the Synology text editor, or mount your file share on a PC and use your favorite text editing program. Another option is to use HASS Configurator, a web-based text editor than can load your config files. It also provides helpful links and verification that your files are formatted correctly.</p>
                    <p class="blog-body">To verify you've installed Home Assistant correctly, go to <code>http://your_Synology_IP:8123</code> and ensure you can see the Home Assistant welcome screen.</p>
                    <h4>Step 3: Configuring Home Assistant</h4>
                    <p class="blog-body">Now that Home Assistant is installed and running, we can work on configuring services for it to use.</p>
                    <p class="blog-body">I use the following services or devices:</p>
                    <ul>
                      <li>Logitech Harmony Hub & Remote</li>
                      <li>Google Assistant</li>
                      <li>Sylvania Smart Lights (Zigbee)</li>
                      <li>Sylvania dimmer switches (Zigbee)</li>
                      <li>TP-Link HS110 smart plugs</li>
                      <li>Dark Sky (weather provider)</li>
                      <li>Spotify</li>
                    </ul>
                    <p class="blog-body">I'll go through each and describe what I use it for and my configuration.</p>
                    <h5>Zigbee Lights & Switches</h5>
                    <p>Adding your Zigbee devices takes some command-line wizardry. First, SSH into your Synology device. Run <code>cat /dev/tty*</code>. You should see  <code>/dev/ttyUSB0</code> and <code>/dev/ttyUSB1</code>. This shows the USB device is recognized by the Synology.</p>
                    <p class="blog-body">The below command assumes you downloaded the container named <code>home-assistant</code> from <code>homeassisstant</code>. I keep my config files in the Synology folder <code>/volume1/Vault/configs/ha/config</code>. Make sure you keep the <code>:/config</code> - this maps the Synology directory to a mounted directory in the container.</p>
                    <p class="blog-body">Then, run the command below:</p>
                    <code>sudo docker run --name home-assistant --restart=always --net=host -itd -v /volume1/Vault/configs/ha/config:/config --device /dev/ttyUSB0 --device /dev/ttyUSB1 homeassistant/home-assistant</code></p>
                    <p class="blog-body">This should create the docker container with everything it needs to run Home Assistant with Zigbee and Z-Wave devices.</p>
                    <p class="blog-body">Zigbee should be <code>/tty/USB1</code>. To add it to Home Assistant, active the Zigbee component in your config. You'll need to specify a complete path to store the zigbee.db file - it will be automatically created but the directory it's in must exist.</p>
<pre><code>zha:
  usb_path: /dev/ttyUSB1
  database_path: /config/zigbee.db</code></pre>
                    <p class="blog-body">After doing this and performing a reboot of Home Assistant, you should see the <code>zha.permit</code> and <code>zha.remove</code> under the "Services" menu and in the Settings page. Put your lights into pairing mode, and then click <code>call service</code>. They should flash to confirm the pairing.</p>
                    <h5>Logitech Harmony</h5>
                    <h6>🔧Harmony Setup</h6>
                    <p class="blog-body">You'll want to set up your Harmony Hub & Remote with all your devices and activities first.</p>
                    <p class="blog-body">After making sure everything works the way you like with the app, you can never wait for it to load again - it's easier and much faster to trigger Activities with Home Assistant.</p>
                    <p  class="blog-body">As of 1/3/2019, you'll need to enable Developer Mode on the Hub to use it with Home Assistant. Plug in the Harmony device to your PC, open the software, and press <code>Alt + F9</code>. You should see a prompt to enable developer mode.</p>
                    <p class="blog-body">
                      After enabling developer mode, use the Harmony app to make sure all of your devices and activities have been set up. Set up any activities or devices you need before continuing.
                    </p>
                    <h6>⚙️Home Assistant Configuration</h6>
                    <p class="blog-body">
                      Home Assistant's Lovelace UI makes adding buttons for your Harmony activities easy. First, make sure your device is setup in your <code>config.yaml</code> like so:
                    </p>
                    <code>TODO INCLUDE SNIPPET</code>
                    <p class="blog-body">After adding to your config and rebooting, test it by toggling the switch for your device in the States UI. Click the <code>i</code> icon in the sidebar and click "access state UI" to see the states UI.
                    </p>
                    <p class="blog-body">
                      After making sure the integration is working, you can then add buttons to your main Home Assistant screen, also known as the Lovelace UI. See here for more information on how to write your <code>ui-lovelace.yaml</code>. Mine looks like this:
                    </p>
                    <pre><code>
cards:
- type: vertical-stack
  cards:
    # --- HARMONY ---
    - type: entity-button
      name: play switch
      icon: mdi:gamepad
      entity: [remote.studio_hub]
      tap_action:
        action: call-service
        service: remote.turn_on
        service_data:
          entity_id: remote.studio_hub
          activity: "Play Switch"
                              </code></pre>
                      <p class="blog-body">
                        The type field means I added a button - I just want to click the button to start the Harmony activity. The Name isn't really relevant. The icon is the icon code from TODO ADD LINK. The entity identifies the Harmony Hub performing the action. Under <code>tap_action</code>, the main thing you'll need to change is the entity_id (which does need to be repeated) and the activity. You can get the list of activity names and IDs from
                        <code>harmony_your_hub_name.conf</code> in your Home Assistant configuration directory.
                      </p>
                      <h5>Dark Sky</h5>
                      <p class="blog-body">
                        Dark Sky is a very accurate weather provider that you can get free API access for. You can configure any of the data it provides into a card in Home Assistant. I keep mine simple, just showing me the forecast for the day like so:
                      </p>
                      <pre><code>
weather:
  - platform: darksky
    api_key: ca523bd948b5f7c2085f6a5777330544
    monitored_conditions:
      - summary
      - icon
      - precip_probability
      - temperature
</pre></code>
                    <p class="blog-body">

                  </div>
                  <div class="col s12 m12 l4 center">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Home_Assistant_Logo.svg/2000px-Home_Assistant_Logo.svg.png" width="250px" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!--  Scripts-->
  <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <script>
  $(document).ready(function(){
    $('.sidenav').sidenav();
  });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=desert"></script>
  <script>
  $(document).ready(function(){
    $('.sidenav').sidenav();
  });
  </script>

</body>

</html>
